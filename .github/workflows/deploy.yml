# 파일 경로: .github/workflows/deploy.yml

name: Deploy to Server

on:
  push:
    branches:
      - main # main 브랜치에 push 이벤트가 발생했을 때 워크플로우를 실행합니다.

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # 작업이 실행될 환경을 지정합니다. (ex: Linux, Windows, macOS)
    steps:
      - name: Checkout repository # 소스 코드를 가져오는 단계
        uses: actions/checkout@v4

      - name: Setup Node.js # Node.js 기반 프로젝트인 경우 환경을 설정합니다.
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Build project # 프로젝트를 빌드합니다.
        run: npm run build

      - name: Deploy to a remote server # 빌드된 파일을 원격 서버에 배포합니다.
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }} # 원격 서버 IP (GitHub Secrets에 저장)
          username: ${{ secrets.SERVER_USERNAME }} # 서버 사용자명 (GitHub Secrets에 저장)
          key: ${{ secrets.SSH_PRIVATE_KEY }} # SSH 프라이빗 키 (GitHub Secrets에 저장)
          script: |
            cd /home/asapsoft/public_html/subdivision
            git pull origin main
            #npm install --production
            #pm2 restart my-app